## 目标

- 新增固定可选色系模板：信息、成功、警告、错误、清除。
- 用户上传自定义 Jinja2 模板后可实时切换主题并套用样式。
- 识别用户代码中的色系类名（含常见别名），并提供对应配色选择与适配。

## 方案概述

- 以 CSS 变量驱动的通用类名（`.info`、`.success`、`.warning`、`.error`、`.clear`）实现主题；在 iframe 注入基础样式与当前主题变量。
- 前端新增主题下拉框；主题/模板/数据任一变化时重渲染。
- 自动识别用户代码中的色系类名（含别名如 `alert-info`、`text-success` 等），使其与通用类等效生效。
- 后端仅在上下文注入 `theme` 字段供用户模板可选使用，不改变 API 返回结构。

## 色系识别与别名支持

- 内置别名字典：
  - 信息：`.info, .alert-info, .badge-info, .text-info`
  - 成功：`.success, .alert-success, .badge-success, .text-success`
  - 警告：`.warning, .alert-warning, .badge-warning, .text-warning`
  - 错误：`.error, .alert-danger, .alert-error, .badge-error, .text-danger, .text-error`
  - 清除：`.clear, .alert-secondary, .badge-secondary, .text-secondary`
- 在 iframe 的样式注入中，将别名选择器与通用类一并声明，使用户模板无需改动即可套用主题配色。
- 可选自定义映射：前端尝试解析 `Context Data (JSON)` 中的 `classMap` 字段（例如 `{ "myInfo": "info" }`），动态把用户自定义类映射到通用类别；若解析失败或未提供则使用内置字典。

## 具体实现

### 前端 UI（`templates/index.html`）
- 新增 `select` 主题下拉框：`default/ocean/emerald/amber/crimson`。
- 监听下拉变更，合并现有 500ms 防抖渲染逻辑。
- 在写入 iframe 时：构造完整 HTML，`<style>` 中包含：
  - 基础类规则（使用 CSS 变量定义背景/文本/边框）。
  - 当前主题的变量值。
  - 内置别名选择器与可选 `classMap` 动态别名。
- 可选：在 UI 显示“已识别色系类别”标签（根据 iframe DOM 扫描匹配到的类名类别），用于反馈识别结果，不影响核心功能。

### 主题与变量
- 变量集：`--info-bg/--info-text/--info-border`、`--success-*`、`--warning-*`、`--error-*`、`--clear-*`。
- 主题示例：
  - `default`（中性灰蓝）
  - `ocean`（蓝系）
  - `emerald`（绿系）
  - `amber`（橙黄系）
  - `crimson`（红系）

### 后端（`app.py`）
- `/render` 接收请求体中的 `theme`（默认 `default`），注入到渲染上下文：`context['theme'] = theme`。
- 保持错误处理与返回 `{ result: rendered_html }` 不变。

### 数据流
- 前端发送：`{ template, context, theme }`。
- 后端渲染：`Template(template).render(**context, theme=theme)`。
- 前端 iframe：`<style>基础类 + 主题变量 + 别名/动态映射</style> + rendered_html`。

## 文件改动点
- `templates/index.html`：新增主题选择；更新渲染函数以携带 `theme`；在 iframe 注入样式与别名支持；（可选）显示识别标签。
- `app.py`：在 `/render` 中把 `theme` 加入上下文，不改变返回结构。

## 校验
- 默认模板添加示例元素（`.info/.success/.warning/.error/.clear`）验证主题切换即时生效。
- 验证常见别名类（如 `alert-info`）是否被正确套用。
- 保持 JSON/Jinja2 错误提示原逻辑；切换主题不影响错误处理。

## 文档与记录
- 更新 `说明文档.md`：方案、接口与进度记录，新增“色系模板切换（含别名识别）”。

## 交付标准
- 主题切换无刷新、500ms 防抖生效。
- 用户模板使用通用类或常见别名均可获得正确配色；可选支持自定义 `classMap`。
- 不改变现有 API 契约与核心渲染路径。